<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Registrar Producto</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto; margin: 2em; }
        .msg { margin-top: 1em; color: green; }
        .error { color: red; }
        label, input { display: block; margin-bottom: 0.5em; }
        button { padding: 0.5em 1em; }
    </style>
</head>
<body>
    <h2>Registrar Producto</h2>
    <form id="productForm">
        <label>Código de barras: <input name="barcode" required /></label>
        <label>Nombre: <input name="name" /></label>
        <label>Proveedor: <input name="provider" /></label>
        <button type="submit">Registrar</button>
    </form>
    <div class="msg" id="msg"></div>
    <script>
        const form = document.getElementById("productForm");
        const msg = document.getElementById("msg");
        form.addEventListener("submit", async (e) => {
            e.preventDefault();
            msg.textContent = "Registrando…";
            msg.className = "msg";
            const data = Object.fromEntries(new FormData(form));
            const t0 = performance.now();
            try {
                const res = await fetch("/products/register/api/", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data),
                });
                const result = await res.json();
                const t1 = performance.now();
                const rtt = Math.round(t1 - t0);
                if (!result.ok) throw new Error(result.error);
                msg.textContent = `OK (#${result.product_id}) | t_srv=${result.duration_ms}ms | t_e2e=${rtt}ms`;
                form.reset();
            } catch (err) {
                msg.textContent = "Fallo: " + err.message;
                msg.className = "msg error";
            }
        });
    </script>
</body>
</html>